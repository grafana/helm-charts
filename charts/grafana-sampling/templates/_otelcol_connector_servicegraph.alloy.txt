{{- define "statefulset.connector.servicegraph" -}}
otelcol.connector.servicegraph "default" {
  // https://grafana.com/docs/alloy/latest/reference/components/otelcol.connector.servicegraph/
  dimensions = [
    {{- range $.Values.metricsGeneration.dimensions }}
    {{ . | quote }},
    {{- end }}
  ]
  latency_histogram_buckets = {{ $.Values.metricsGeneration.serviceGraph.histogramBuckets | toJson }}
  metrics_flush_interval = {{ $.Values.metricsGeneration.serviceGraph.metricsFlushInterval | quote }}

  store {
    ttl = "2s"
  }

  output {
    metrics = [otelcol.processor.batch.default.input]
  }
}

{{ end }}

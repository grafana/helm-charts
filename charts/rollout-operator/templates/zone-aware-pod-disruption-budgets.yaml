{{- $root := . -}}
{{- range $idx, $zpdb := .Values.webhooks.zoneAwarePodDisruptionBudgets }}
---
apiVersion: rollout-operator.grafana.com/v1
kind: ZoneAwarePodDisruptionBudget
metadata:
  name: {{ $zpdb.name }}
  namespace: {{ $root.Release.Namespace | quote }}
  {{- if $zpdb.labels }}
  labels:
    {{- toYaml $zpdb.labels | nindent 4 }}
  {{- end }}
  {{- if $zpdb.annotations }}
  annotations:
    {{- toYaml $zpdb.annotations | nindent 4 }}
  {{- end }}
spec:
  {{- if $zpdb.maxUnavailable }}
  maxUnavailable: {{ int $zpdb.maxUnavailable }}
  {{- else if $zpdb.maxUnavailablePercentage }}
  maxUnavailablePercentage: {{ int $zpdb.maxUnavailablePercentage }}
  {{- end }}
  {{- if $zpdb.podNamePartitionRegex }}
  podNamePartitionRegex: {{ $zpdb.podNamePartitionRegex | quote }}
  {{- if $zpdb.podNameRegexGroup }}
  podNameRegexGroup: {{ int $zpdb.podNameRegexGroup }}
  {{- end }}
  {{- end }}
  {{- if $zpdb.matchLabels }}
  selector:
    matchLabels:
      {{- toYaml $zpdb.matchLabels | nindent 6 }}
  {{- end }}
{{- end -}}